import { defineCollection, z } from 'astro:content';
import { glob } from 'astro/loaders';

// May also need to update /src/types/index.d.ts when updating this file
// When updating the set of searchable collections, update collectionList in /src/pages/search.astro

const searchable = z.object({
    title: z.string(),
    description: z.string().optional(),
    autodescription: z.boolean().default(true),
    draft: z.boolean().default(false),
});

const docs = defineCollection({
    loader: glob({ pattern: '**/[^_]*.{md,mdx}', base: './src/content/docs' }),
    schema: ({ image }) =>
        searchable.extend({
            pubDate: z.date().optional(),
            modDate: z.date().optional(),
            image: image().optional(),
            imageAlt: z.string().default(''),
            hideToc: z.boolean().default(false),
            hideNav: z.boolean().default(false),
        }),
});

const home = defineCollection({
    loader: glob({ pattern: '-index.{md,mdx}', base: './src/content/home' }),
    schema: ({ image }) =>
        z.object({
            image: image().optional(),
            imageAlt: z.string().default(''),
            title: z.string(),
            content: z.string(),
            button: z
                .object({
                    label: z.string(),
                    link: z.string().optional(),
                })
                .optional(),
        }),
});

// Export collections
export const collections = {
    docs,
    home,
};
